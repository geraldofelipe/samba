vulpe.ng.app.controller("IndexController",["$rootScope","$scope","VulpeJS",function(a,d,c){var e=new c().init(d);var g={formats:"(dv|webm|mkv|flv|vob|ogv|ogg|drc|mng|avi|mov|qt|wmv|yuv|rm|rmvb|asf|mp4|m4p|m4v|mpg|mp2|mpeg|mpe|mpv|mpg|mpeg|m2v|m4v|svi|3gp|3g2|mxf|roq|nsv)",status:{all:["waiting","pending","processing","finished","failed","cancelled"],end:["finished","failed","cancelled"]}};var f={allowedExtensions:/\.(dv|webm|mkv|flv|vob|ogv|ogg|drc|mng|avi|mov|qt|wmv|yuv|rm|rmvb|asf|mp4|m4p|m4v|mpg|mp2|mpeg|mpe|mpv|mpg|mpeg|m2v|m4v|svi|3gp|3g2|mxf|roq|nsv)/i};e.timeout.cancel();e.item={url:""};e.jobs=function(){e.http.get({url:"/jobs",callback:function(h){e.items=h;e.items.forEach(function(i){if(i.job.state!=="finished"){e.progress(i.job.id)}})}})};var b=function(){e.timeout.add(function(){e.ui.focus("url")},100)};e.cancel=function(h){e.http.get({url:"/job/cancel/"+h,callback:function(i){e.jobs();e.message.success("Video encoding successfully cancelled!")}})};e.progress=function(h){e.http.get({url:"/job/progress/"+h,callback:function(m){for(var k=0,j=e.items.length;k<j;++k){var l=e.items[k];if(l.job.id===h){l.job.state=m.state;if(g.status.end.indexOf(m.state)===-1){e.timeout.add(function(){e.progress(h)},3000)}break}}}})};e.send=function(){e.message.clean();if(e.item.url&&e.item.url.length>0){if(!vulpe.utils.regex.weburl.test(e.item.url)){e.message.error("Please, enter a valid URL.");b();return}var h=e.item.url.split("/").pop().toLowerCase();if(!f.allowedExtensions.test(h)){e.message.error("Please, enter a video with one of the following formats: "+g.formats);b();return}e.http.post({url:"/job",data:e.item,callback:{success:function(i){e.item.url="";e.jobs();e.message.success("Video successfully sent to encode!")},error:function(i){e.message.error("Unable to send the video to encode.")}}})}else{e.message.info("Please, enter the video URL to encode!");b()}};e.on.ready(function(){e.ui.active("index",true);e.jobs();b()})}]);